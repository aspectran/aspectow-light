<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aspectran PUBLIC "-//ASPECTRAN//DTD Aspectran 8.0//EN"
        "http://aspectran.github.io/dtd/aspectran-8.dtd">
<aspectran>

    <description>
        Aspectran configuration for setting root web application.
    </description>

    <environment>
        <properties>
            <item name="tow.context.path">/webroot</item>
            <item name="tow.context.scratch_dir">/work/_webroot</item>
        </properties>
    </environment>

    <bean id="tow.context.hybridHttpHandler" class="com.aspectran.undertow.server.http.HybridHttpHandlerFactoryBean"
          scope="prototype">
        <properties>
            <item name="towServer">#{tow.server}</item>
            <item name="resourceManager">
                <bean class="com.aspectran.undertow.server.resource.TowResourceManager">
                    <properties>
                        <item name="base">%{tow.context.path}</item>
                    </properties>
                </bean>
            </item>
            <item name="sessionManager">#{tow.context.sessionManager}</item>
            <item name="sessionConfig">
                <bean class="io.undertow.server.session.SessionCookieConfig"/>
            </item>
            <item name="outerHandlerChainWrappers" type="array">
                <value>#{tow.server.encodingHandlerWrapper}</value>
                <value>#{tow.server.accessLogHandlerWrapper}</value>
            </item>
        </properties>
    </bean>

    <bean id="tow.context.sessionManager" class="com.aspectran.undertow.server.session.TowSessionManager"
          scope="prototype">
        <properties>
            <item name="sessionManagerConfig">
                <bean class="com.aspectran.core.context.config.SessionManagerConfig">
                    <arguments>
                        <item>
                            workerName: n0
                            maxActiveSessions: 99
                            maxIdleSeconds: 1800
                            evictionIdleSeconds: 900
                            scavengingIntervalSeconds: 600
                            clusterEnabled: false
                        </item>
                    </arguments>
                </bean>
            </item>
            <item name="sessionStore">
                <bean class="com.aspectran.core.component.session.FileSessionStoreFactory">
                    <properties>
                        <item name="storeDir">/work/_sessions/tow</item>
                        <item name="nonPersistentAttributes" type="array">
                            <value>io.undertow.websocket.current-connections</value>
                        </item>
                    </properties>
                </bean>
            </item>
        </properties>
    </bean>

    <bean id="tow.server.encodingHandlerWrapper" class="com.aspectran.undertow.server.encoding.EncodingHandlerWrapper"
          scope="prototype">
        <properties>
            <item name="contentEncodingProviders" type="array">
                <value>gzip</value>
                <value>deflate</value>
            </item>
            <item name="maxContentSize" valueType="long">32</item>
            <item name="mediaTypes" type="array">
                <value>text/html</value>
                <value>text/xml</value>
                <value>text/plain</value>
                <value>text/css</value>
                <value>text/javascript</value>
                <value>application/javascript</value>
                <value>application/json</value>
                <value>application/xml</value>
                <value>application/apon</value>
            </item>
        </properties>
    </bean>

    <bean id="tow.server.accessLogHandlerWrapper" class="com.aspectran.undertow.server.accesslog.AccessLogHandlerWrapper"
          scope="prototype">
        <properties>
            <item name="formatString">combined</item>
            <item name="category">io.undertow.accesslog</item>
        </properties>
    </bean>

</aspectran>
